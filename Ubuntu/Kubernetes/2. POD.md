# 1. Pod
- PodëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ìƒì„±í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ë°°í¬ ê°€ëŠ¥í•œ ê°€ì¥ ì‘ì€ ì»´í“¨íŒ… ë‹¨ìœ„
  - https://kubernetes.io/ko/docs/concepts/workloads/pods/
- ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” Dockerì˜ Container ë‹¨ìœ„ê°€ ì•„ë‹Œ Pod ë‹¨ìœ„ë¡œ ìŠ¤ì¼€ì¤„ë§, ë¡œë“œë°¸ëŸ°ì‹±, ìŠ¤ì¼€ì¼ë§ ë“±ì˜ ê´€ë¦¬ ì‘ì—… ìˆ˜í–‰
  - ì¿ ë²„ë„¤í‹°ìŠ¤ì— ì–´ë–¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•˜ê³  ì‹¶ìœ¼ë©´ ìµœì†Œ Podë¡œ êµ¬ì„±
  - PodëŠ” Containerë¥¼ ê°ì‹¼ ê°œë…
    - í•˜ë‚˜ì˜ PodëŠ” í•œ ê°œì˜ Container ë˜ëŠ” ì—¬ëŸ¬ ê°œì˜ Containerë¡œ ì´ë£¨ì–´ì§ˆ ìˆ˜ ìˆìŒ
    - Pod ë‚´ë¶€ì˜ ì—¬ëŸ¬ ContainerëŠ” ìì›ì„ ê³µìœ 
    - PodëŠ” Stateless(ì´ì „ì˜ ìƒíƒœë¥¼ ê¸°ì–µí•˜ê±°ë‚˜ ì €ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤, ë…ë¦½ì ìœ¼ë¡œ ì²˜ë¦¬) í•œ íŠ¹ì§•ì„ ì§€ë‹ˆê³  ìˆê³ , ì–¸ì œë“ ì§€ ì‚­ì œë  ìˆ˜ ìˆëŠ” ìì›

# 2. Pod ìƒì„±
  - Pod ì˜ˆì‹œ(yaml íŒŒì¼)
  - ëŒ€ë¶€ë¶„ apiVersion, kind, metadata, specìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆê³  specì— valueë¡œ ë“¤ì–´ê°€ëŠ” ë¶€ë¶„ì´ í•­ìƒ main íŒŒíŠ¸
    ```
    apiVersion: v1     #kubernetes resourceì˜ API Version
    kind: Pod          #kubernetes resource name
    metadata:          #ë©”íƒ€ë°ì´í„° : name, namespace, labels, annotations ë“± í¬í•¨
      name: counter
    spec:              #ë©”ì¸ íŒŒíŠ¸ : resoucreì˜ desired state ëª…ì‹œ
      containers:
      - name: count    #containerì˜ ì´ë¦„
        image: busybox #containerì˜ image
        #í•´ë‹¹ imageì˜ entrypointì˜ argsë¡œ ì…ë ¥í•˜ê³  ì‹¶ì€ ë¶€ë¶„
        args: [/bin/sh, -c, 'i=0; while true; do echo "$i: $(date)"; i=$((i+1)); sleep 1; done'] 
    ```
    ```
    vi pod.yaml
    # ìœ„ ë‚´ìš© ë³µë¶™

    oh@oh-VirtualBox:~/kubernetes-tutorial$ minikube start --driver=docker

    ğŸ˜„  Ubuntu 22.04 (vbox/amd64) ì˜ minikube v1.31.2
    âœ¨  ìœ ì € í™˜ê²½ ì„¤ì • ì •ë³´ì— ê¸°ë°˜í•˜ì—¬ docker ë“œë¼ì´ë²„ë¥¼ ì‚¬ìš©í•˜ëŠ” ì¤‘
    ğŸ“Œ  Using Docker driver with root privileges
    ğŸ‘  minikube í´ëŸ¬ìŠ¤í„°ì˜ minikube ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ ë…¸ë“œë¥¼ ì‹œì‘í•˜ëŠ” ì¤‘
    ğŸšœ  ë² ì´ìŠ¤ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë°›ëŠ” ì¤‘ ...
    ğŸ”¥  Creating docker container (CPUs=2, Memory=2900MB) ...
    ğŸ³  ì¿ ë²„ë„¤í‹°ìŠ¤ v1.27.4 ì„ Docker 24.0.4 ëŸ°íƒ€ì„ìœ¼ë¡œ ì„¤ì¹˜í•˜ëŠ” ì¤‘
    â–ª ì¸ì¦ì„œ ë° í‚¤ë¥¼ ìƒì„±í•˜ëŠ” ì¤‘ ...
    â–ª ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ì´ ë¶€íŒ…...
    â–ª RBAC ê·œì¹™ì„ êµ¬ì„±í•˜ëŠ” ì¤‘ ...
    ğŸ”—  Configuring bridge CNI (Container Networking Interface) ...
    â–ª Using image gcr.io/k8s-minikube/storage-provisioner:v5
    ğŸ”  Kubernetes êµ¬ì„± ìš”ì†Œë¥¼ í™•ì¸...
    ğŸŒŸ  ì• ë“œì˜¨ í™œì„±í™” : default-storageclass, storage-provisioner
    ğŸ„  ëë‚¬ìŠµë‹ˆë‹¤! kubectlì´ "minikube" í´ëŸ¬ìŠ¤í„°ì™€ "default" ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©í•˜ë„ë¡ êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

    oh@oh-VirtualBox:~/kubernetes-tutorial$ kubectl apply -f pod.yaml
    pod/counter created

    oh@oh-VirtualBox:~/kubernetes-tutorial$ kubectl get pod
    NAME      READY   STATUS    RESTARTS   AGE
    counter   1/1     Running   0          2m23s
    ```
    - kubectl apply -f <yaml-file-paht>ë¥¼ ìˆ˜í–‰í•˜ë©´ <yaml-file-path>ì— í•´ë‹¹í•˜ëŠ” kubernetes resourceë¥¼ ìƒì„± ë˜ëŠ” ë³€ê²½ ê°€ëŠ¥
    - kubernetes resourceì˜ desired stateë¥¼ ê¸°ë¡í•´ë†“ê¸° ìœ„í•´ í•­ìƒ YAML íŒŒì¼ì„ ì €ì¥í•˜ê³  ë²„ì „ ê´€ë¦¬í•˜ëŠ” ê²ƒì„ ê¶Œì¥
      
# 3. Pod ì¡°íšŒ
- ìœ„ì—ì„œ current namespaceì˜ Pod ëª©ë¡ì„ ì¡°íšŒí•˜ëŠ” ëª…ë ¹ì„ ìˆ˜í–‰í–ˆëŠ”ë° Desired stateê°€ ì•„ë‹Œ Current Stateë¥¼ ì¶œë ¥
- namespace
  - kubernetesì—ì„œ ë¦¬ì†ŒìŠ¤ë¥¼ ê²©ë¦¬í•˜ëŠ” ê°€ìƒì˜(ë…¼ë¦¬ì ì¸) ë‹¨ìœ„
  - kubectl config view --minify | grep namespace: ë¡œ current namespaceê°€ ì–´ë–¤ namespaceë¡œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸ ê°€ëŠ¥
    - ë”°ë¡œ ì„¤ì •í•˜ì§€ ì•Šì•˜ìœ¼ë©´ default namespaceê°€ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì •
- íŠ¹ì • namespace ë˜ëŠ” ëª¨ë“  namespaceì˜ pod ì¡°íšŒ ê°€ëŠ¥
  ```
  oh@oh-VirtualBox:~/kubernetes-tutorial$ kubectl get pod -n kube-system
  # kube-system namespaceì˜ pod ì¡°íšŒ
  NAME                               READY   STATUS    RESTARTS        AGE
  coredns-5d78c9869d-9f2qr           1/1     Running   1 (5m27s ago)   37m
  etcd-minikube                      1/1     Running   1 (5m27s ago)   37m
  kube-apiserver-minikube            1/1     Running   1 (5m27s ago)   37m
  kube-controller-manager-minikube   1/1     Running   1 (5m27s ago)   37m
  kube-proxy-zl4d6                   1/1     Running   1 (5m27s ago)   37m
  kube-scheduler-minikube            1/1     Running   1 (5m27s ago)   37m
  storage-provisioner                1/1     Running   3 (4m21s ago)   37m

  oh@oh-VirtualBox:~/kubernetes-tutorial$ kubectl get pod -A
  # ëª¨ë“  namespaceì˜ pod ì¡°íšŒ
  NAMESPACE     NAME                               READY   STATUS    RESTARTS        AGE
  default       counter                            1/1     Running   1 (5m38s ago)   36m
  kube-system   coredns-5d78c9869d-9f2qr           1/1     Running   1 (5m38s ago)   37m
  kube-system   etcd-minikube                      1/1     Running   1 (5m38s ago)   37m
  kube-system   kube-apiserver-minikube            1/1     Running   1 (5m38s ago)   37m
  kube-system   kube-controller-manager-minikube   1/1     Running   1 (5m38s ago)   37m
  kube-system   kube-proxy-zl4d6                   1/1     Running   1 (5m38s ago)   37m
  kube-system   kube-scheduler-minikube            1/1     Running   1 (5m38s ago)   37m
  kube-system   storage-provisioner                1/1     Running   3 (4m32s ago)   37m

  oh@oh-VirtualBox:~/kubernetes-tutorial$ kubectl get pod counter
  #pod í•˜ë‚˜ ì¡°íšŒ
  NAME      READY   STATUS    RESTARTS      AGE
  counter   1/1     Running   1 (79m ago)   110m

  oh@oh-VirtualBox:~/kubernetes-tutorial$ kubectl describe pod counter
  #pod í•˜ë‚˜ë¥¼ ë” ìì„¸í•˜ê²Œ ì¡°íšŒ
  Name:             counter
  Namespace:        default
  Priority:         0
  Service Account:  default
  Node:             minikube/192.168.49.2
  Start Time:       Tue, 12 Sep 2023 23:16:12 +0900
  Labels:           <none>
  Annotations:      <none>
  Status:           Running
  IP:               10.244.0.5
  IPs:
    IP:  10.244.0.5
  Containers:
    count:
    Container ID:  docker://f658feb219055af3eaa3f99d7ea8892b9c20d2afe9dfdbf0f5486e7e9fdf47e3
    Image:         busybox
    Image ID:      docker-pullable://busybox@sha256:3fbc632167424a6d997e74f52b878d7cc478225cffac6bc977eedfe51c7f4e79
    Port:          <none>
    Host Port:     <none>
    Args:
      /bin/sh
      -c
      i=0; while true; do echo "$i: $(date)"; i=$((i+1)); sleep 1; done
    State:          Running
      Started:      Tue, 12 Sep 2023 23:47:42 +0900
    Last State:     Terminated
      Reason:       Error
      Exit Code:    255
      Started:      Tue, 12 Sep 2023 23:16:18 +0900
      Finished:     Tue, 12 Sep 2023 23:47:04 +0900
    Ready:          True
    Restart Count:  1
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-56kkh (ro)
  Conditions:
    Type              Status
    Initialized       True 
    Ready             True
    ContainersReady   True 
    PodScheduled      True 
  Volumes:
    kube-api-access-56kkh:
      Type:                    Projected (a volume that contains injected data from multiple sources)
      TokenExpirationSeconds:  3607
      ConfigMapName:           kube-root-ca.crt
      ConfigMapOptional:       <nil>
      DownwardAPI:             true
  QoS Class:                   BestEffort
  Node-Selectors:              <none>
  Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                               node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
  Events:                      <none>
  ```
- ê¸°íƒ€ ëª…ë ¹ì–´
  ```
  oh@oh-VirtualBox:~/kubernetes-tutorial$ kubectl get pod -o wide
  # pod ëª©ë¡ì„ ë³´ë‹¤ ìì„¸íˆ ì¶œë ¥
  NAME      READY   STATUS    RESTARTS      AGE    IP           NODE       NOMINATED NODE   READINESS GATES
  counter   1/1     Running   1 (83m ago)   114m   10.244.0.5   minikube   <none>           <none>

  oh@oh-VirtualBox:~/kubernetes-tutorial$ kubectl get pod counter -o yaml
  #<pod-name>ì„ yaml í˜•ì‹ìœ¼ë¡œ ì¶œë ¥
  apiVersion: v1
  kind: Pod

  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","kind":"Pod","metadata":{"annotations":{},"name":"counter","namespace":"default"},"spec":{"containers":[{"args":["/bin/sh","-c","i=0; while true; do echo \"$i: $(date)\"; i=$((i+1)); sleep 1; done"],"image":"busybox","name":"count"}]}}
    creationTimestamp: "2023-09-12T14:16:12Z"
    name: counter
    namespace: default
    resourceVersion: "1215"
    uid: 2ebc150c-b67a-4392-9bfd-e55c1ccd0ec8
  spec:
    containers:
    - args:
      - /bin/sh
      - -c
      - 'i=0; while true; do echo "$i: $(date)"; i=$((i+1)); sleep 1; done'
      image: busybox
      imagePullPolicy: Always
      name: count
      resources: {}
      terminationMessagePath: /dev/termination-log
      terminationMessagePolicy: File
      volumeMounts:
      - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-56kkh
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: minikube
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: Always
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300
    volumes:
    - name: kube-api-access-56kkh
      projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
              path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
              path: namespace
  status:
    conditions:
    - lastProbeTime: null
      lastTransitionTime: "2023-09-12T14:16:12Z"
      status: "True"
      type: Initialized
    - lastProbeTime: null
      lastTransitionTime: "2023-09-12T14:47:43Z"
      status: "True"
      type: Ready
    - lastProbeTime: null
      lastTransitionTime: "2023-09-12T14:47:43Z"
      status: "True"
      type: ContainersReady
    - lastProbeTime: null
      lastTransitionTime: "2023-09-12T14:16:12Z"
      status: "True"
      type: PodScheduled
    containerStatuses:
    - containerID: docker://f658feb219055af3eaa3f99d7ea8892b9c20d2afe9dfdbf0f5486e7e9fdf47e3
      image: busybox:latest
      imageID: docker-pullable://busybox@sha256:3fbc632167424a6d997e74f52b878d7cc478225cffac6bc977eedfe51c7f4e79
      lastState:
        terminated:
          containerID: docker://fa9c3cc2706c780b53ae0427b12ed0a8fc7aa3eaf4217cb7f1a85f29068c7757
          exitCode: 255
          finishedAt: "2023-09-12T14:47:04Z"
          reason: Error
          startedAt: "2023-09-12T14:16:18Z"
      name: count
      ready: true
      restartCount: 1
      started: true
      state:
        running:
          startedAt: "2023-09-12T14:47:42Z"
    hostIP: 192.168.49.2
    phase: Running
    podIP: 10.244.0.5
    podIPs:
    - ip: 10.244.0.5
    qosClass: BestEffort
    startTime: "2023-09-12T14:16:12Z"

  oh@oh-VirtualBox:~/kubernetes-tutorial$ kubectl get pod -w
  #kubectl get podì˜ ê²°ê³¼ë¥¼ ê³„ì† ë³´ì—¬ì£¼ë©°, ë³€í™”ê°€ ìˆì„ ë•Œë§Œ ì—…ë°ì´íŠ¸
  NAME      READY   STATUS    RESTARTS      AGE
  counter   1/1     Running   1 (99m ago)   130m
  ```

# 4. Pod ë¡œê·¸
- pod ë¡œê·¸ í™•ì¸ : kubectl logs <pod-name> -f(<pod-name>ì˜ ë¡œê·¸ë¥¼ ê³„ì† ë³´ì—¬ì¤Œ
  ```
  oh@oh-VirtualBox:~/kubernetes-tutorial$ kubectl logs counter

  0: Tue Sep 12 14:47:42 UTC 2023
  1: Tue Sep 12 14:47:43 UTC 2023
  ```
- pod ì•ˆì— ì—¬ëŸ¬ ê°œì˜ containerê°€ ìˆëŠ” ê²½ìš°
  ```
  kubectl logs <pod-name> -c <container-name> -f
  ```

# 5. Pod ë‚´ë¶€ ì ‘ì†
- pod ë‚´ë¶€ì— ì ‘ì†í•˜ëŠ” ëª…ë ¹ì–´, docker execì™€ ë¹„ìŠ·í•œ ëª…ë ¹
- pod ì•ˆì— ì—¬ëŸ¬ ê°œì˜ containerê°€ ìˆìœ¼ë©´ -> kubectl exec -it <pod-name> -c <container-name> -- <ëª…ë ¹ì–´>
  ```
  oh@oh-VirtualBox:~/kubernetes-tutorial$ kubectl exec -it counter -- sh

  / # 
  / # ls
  bin    dev    etc    home   lib    lib64  proc   root   sys    tmp    usr    var
  / # hostname
  counter
  / # exit
  ```

# 6. Pod ì‚­ì œ
- pod ì‚­ì œ ëª…ë ¹ì–´
  ```
  oh@oh-VirtualBox:~/kubernetes-tutorial$ kubectl delete pod counter

  pod "counter" deleted

  oh@oh-VirtualBox:~/kubernetes-tutorial$ kubectl get pod
  No resources found in default namespace.

  oh@oh-VirtualBox:~/kubernetes-tutorial$ kubectl delete -f pod.yaml
  # ìœ„ì™€ ê°™ì´ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•  ë•Œ, ì‚¬ìš©í•œ yaml íŒŒì¼ì„ ì‚¬ìš©í•´ì„œ ì‚­ì œ ê°€ëŠ¥, ê¼­ podê°€ ì•„ë‹ˆë”ë¼ë„ ëª¨ë“  kubernettes resourceì— ì ìš© ê°€ëŠ¥
  Error from server (NotFound): error when deleting "pod.yaml": pods "counter" not found
  ```
